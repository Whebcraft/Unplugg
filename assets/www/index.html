<!DOCTYPE html> 
<html> 
    <head> 
    <title>Unplugg</title> 
    
    <meta name="viewport" content="width=device-width, initial-scale=1"> 

    <link rel="stylesheet" href="jqm/jquery.mobile-1.0.css" />
    <link rel="stylesheet" href="jqm/mobiscroll-1.6.css" />
    <script type="text/javascript" src="jqm/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="jqm/jquery.mobile-1.0.js"></script>
    <script type="text/javascript" src="jqm/mobiscroll-1.6.js"></script>
    <script type="text/javascript" src="cordova-1.6.0.js"></script>
    <script type="text/javascript" src="unplugg.js"></script>
    <script type="text/javascript" src="LocalNotification.js"></script>
    <script type="text/javascript">
        function init() {
            document.addEventListener("deviceready", onDevReady, false);
        }
        
        function onDevReady() {
            console.log("We are good to go.");                     
        }
        
        $(document).ready(function() {
            // Handler for .ready() called.
            $('#date1').scroller({ preset: 'time', theme: "android", mode: "clickpick" });
            $('#date2').scroller({ preset: 'time', theme: "android", mode: "clickpick" });
        });
        
        function toggleDiv(id) {
            $("#"+id).show().siblings().hide();
        }
        
        function unpluggNow(enable) {
            console.log("Toggle Airplane");
            if (enable) {
                $('#unpluggBtn').hide();
                $('#unpluggBtn2').show();
                window.plugins.unplugg.toggleAirplaneMode(true);
            } else {
                $('#unpluggBtn').show();
                $('#unpluggBtn2').hide();
                clearTimeout(timeoutId);
                window.plugins.unplugg.toggleAirplaneMode(false);
            }
        }
        
        function unpluggFor(interval) {
            console.log("Setting Timer");

            $('#unpluggBtn').hide();
            $('#unpluggBtn2').show();
            window.plugins.unplugg.toggleAirplaneMode(true);

            var newDateObj = new Date();
            newDateObj.setTime(newDateObj.getTime() + (interval * 60 * 1000));
            window.plugins.localNotification.add(
                { date: newDateObj, message: 'Waking Up!', id: 123, airplane: false });
        }
        
        function saveSchedule() {
            var startDate = parseDate($('#date1').val());
            var endDate = parseDate($('#date2').val());
            var reoccur = $('checkbox-0').is(':checked');
            //window.plugins.unplugg.addSchedule({"start": start, "end": end, "reoccur": false});
            window.plugins.localNotification.add(
                { date: startDate, message: 'Go to sleep!', id: 111, airplane: true, repeatDaily: reoccur });
            window.plugins.localNotification.add(
                { date: endDate, message: 'Waking up now!', id: 222, airplane: false, repeateDaily: reoccur });
        }
        
        function parseDate(datestring) {
            var startDate = new Date();
            
            hour = parseInt(datestring.substring(0, 2));
            min = parseInt(datestring.substring(3,5));
            pm = false;
            if (datestring.substring(6,8) == "PM") {
                pm = true;
            }
            if (pm && hour != 12) {
                hour += 12;
            }
            if (!pm && hour === 12) {
                hour = 0;
            }
            console.log("hour = " + hour + " min = " + min + " pm " + pm);
            
            startDate.setHours(hour);
            startDate.setMinutes(min);
            startDate.setSeconds(0);
            
            return startDate;
        }
    </script>
</head> 
<body onload="init()"> 

<div data-role="page" id="main">

    <div data-role="header">
        <h1>Unplugg</h1>
        <div data-role="navbar">
            <ul>
                <li><a href="#" onclick="toggleDiv('status')" class="ui-btn-active">Status</a></li>
                <li><a href="#" onclick="toggleDiv('schedule')" >Schedules</a></li>
            </ul>
        </div><!-- /navbar -->
    </div><!-- /header -->

    <div>
        <div data-role="content" id="status">
            <a href="#" id="unpluggBtn" onclick="unpluggNow(true)" data-role="button">Unplugg Now!</a>
            <a href="#" id="unpluggBtn2" style="display: none"  data-theme="b" onclick="unpluggNow(false)" data-role="button">Plugg In!</a>            
            <!-- label for="currentStatus">Current Status:</label>
            <div id="currentStatus"></div -->
            
            <label for="unplugs">Unplugg for:</label>
            <div data-role="controlgroup" id="unplugs">                
                <a href="#" onclick="unpluggFor(1)" data-role="button">1 minute</a>
                <a href="#" onclick="unpluggFor(15)" data-role="button">15 minutes</a>
                <a href="#" onclick="unpluggFor(30)" data-role="button">30 minutes</a>
                <a href="#" onclick="unpluggFor(60)" data-role="button">1 hour</a>
            </div>   
        </div><!-- /content -->
    
        <div data-role="content" id="schedule" style="display:none">   
            <a href="#add" data-role="button" data-icon="add">Add a new schedule</a>
        </div><!-- /content -->
    
    </div>

</div><!-- /page -->

<div data-role="page" id="add">

    <div data-role="header">
        <h1>New schedule</h1>
    </div><!-- /header -->

    <div>
        <div data-role="content">   
            <label for="date1">Unplugg at:</label>
            <input type="text" name="date1" id="date1" class="mobiscroll" readonly="readonly" value="" />
            <label for="date2">Wake up at:</label>
            <input type="text" name="date2" id="date2" class="mobiscroll" readonly="readonly" value="" />
            <input type="checkbox" name="checkbox-0" id="checkbox-0" class="custom" />
            <label for="checkbox-0">Repeat daily</label>
            <button data-role="button" onclick="saveSchedule()">Save</button>
        </div><!-- /content -->
    </div>

</div><!-- /page -->

</body>
</html>
